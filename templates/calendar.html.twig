{% extends 'article.html.twig' %}
{% set type = "calendar" %}
{% set types = "events" %}

{% block template %}
{{ parent() }}
<!-- user/plugins/photon-{{ type }}/templates/{{ type }}.html.twig -->
{% endblock %}
{% block body_template_classes %}{{ parent() }} {{ type }}{% endblock body_template_classes %}

{% block schema %}
{{ parent() }}
{% include '_json-ld/' ~ type ~ '.html.twig' ignore missing  %}
{% endblock schema %}

{% set events = page.collection %}

{# TODO this is a copy from article - remove #}
{% block collection %}
  <section class="collection">
    <header>
        <h1>{{ page.header.collection.name }}{% if page.header.collection.showCount %} : <span class="count">{{ page.collection.count() }}</span>{% endif %}</h1>
        {% if page.header.collection.showMenu %}
        <nav>
          {# placeholder functions for filter taxonomy items in current collection #}
          {%- set active_class = (page.active or page.activeChild) ? ' class="active"' : '' %}
          {% for tag in page.taxonomy.tag %}
              <!-- <a href="search/tag:{{ tag }}">{{ tag }}</a> -->
          {% endfor %}

          <!-- <a id="all" href="{{ page.url }}">all</a>
          <a id="tag-featured" href="{{ page.url }}{{ page.url ends with '/' ? '' : '/' }}tag:featured">featured</a>
          <a id="tag-showcase" href="{{ page.url }}{{ page.url ends with '/' ? '' : '/' }}tag:showcase">showcase</a> -->
          <a id="modal" href="javascript:toggleModal();">[ ]</a>
        </nav>
        {% endif %}
      </header>
    {% for article in events %}

      {# %  if article.routable == true and article.visible == true  % #}
        {% include ["_articles/#{ article.template }-excerpt.html.twig", "_articles/article-excerpt.html.twig"] with { 'article': article } %}
      {# %  endif  % #}
    {% endfor %}

    {% include '_sections/pagination.html.twig'   %}
  </section>
  <script type="text/javascript">
  var events = [
    {% for article in events %}
      {# %  if article.routable == true and article.visible == true  % #}
        {% set startDate = article.header.data.event.startDate %}
        {% set endDate = article.header.data.event.endDate %}
        {% set allDay = article.header.data.event.allDay %}
        {% if startDate %}
        {
          title: "{{ article.title }}",
          start: "{{ startDate|date("Y-m-d\\TH:i") }}",
          {% if allDay %}
          allDay: true,
          {% endif %}
          {% if endDate %}
          end: "{{ endDate|date("Y-m-d\\TH:i") }}",
          {% endif %}
          url: "{{ article.url }}",
          className: ""
        },
        {% endif %}
      {# % endif % #}
    {% endfor %}
    ];
  </script>

{% endblock collection %}
